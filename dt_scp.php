<?php
// $url = "http://e-sport.in.th/ssdev/dt/dashboard/auth";


// function reg_login($username, $password)
// {
//     global $url;
//     $data = "username=admin&password=admin";

//     $ch = curl_init();
//     curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
//     curl_setopt($ch, CURLOPT_HEADER, 0);
//     curl_setopt($ch, CURLOPT_POST, 1);
//     curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
//     curl_setopt($ch, CURLOPT_URL, $url);
//     // curl_setopt($ch, CURLOPT_COOKIEJAR, "file.txt");
//     // curl_setopt($ch, CURLOPT_COOKIEFILE, "file.txt");
//     curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

//     $result = curl_exec($ch);
//     curl_close($ch);
//     return $result;
// }




include('./config.php');
require_once('./custom/dt_function.php');

http_response_code(200);

date_default_timezone_set('Asia/Bangkok');
$current_datetime = date("Y-m-d H:i:s");
$content = file_get_contents('php://input');

$events = json_decode($content, true);

foreach ($events['events'] as $event) {

    $userID = $event['source']['userId'];
    $groupID = $event['source']['groupId'];
    $text = $event['message']['text'];
    $text = str_replace(' ', '', $text);
    $text = preg_replace('~[\r\n]+~', '', $text);
    $replyToken = $event['replyToken'];
    $text = iconv_substr($text, 0);
    $text_forcheck_string = $text;
    $text_forcheck_number = $text;
    $user_displayname = linedisplayname($groupID, $userID);

    if ($event['type'] == 'follow') {
        $messages = [
            'type' => 'text',
            'text' => "üßê ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : play " . "\r\n" . "üí∞ ‡πÄ‡∏ä‡πá‡∏Å‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå : id " . "\r\n" . "ü§© ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : step " . "\r\n" . "‚õîÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : x " . "\r\n" . "üìë ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : c "
        ];
    }
    if ($event['type'] == 'memberJoined') {
        $messages = [
            'type' => 'text',
            'text' => "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö : " . $user_displayname . "\r\n" . "üßê ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : play " . "\r\n" . "üí∞ ‡πÄ‡∏ä‡πá‡∏Å‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå : id " . "\r\n" . "ü§© ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : step " . "\r\n" . "‚õîÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : x " . "\r\n" . "üìë ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : c "
        ];
    }
    if ($event['type'] == 'join') {
        $messages = [
            'type' => 'text',
            'text' => "üßê ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : play " . "\r\n" . "üí∞ ‡πÄ‡∏ä‡πá‡∏Å‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå : id " . "\r\n" . "ü§© ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : step " . "\r\n" . "‚õîÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : x " . "\r\n" . "üìë ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå : c "
        ];
    }
    if ($event['type'] == 'message' && $event['message']['type'] == 'text') {

        $split_slash_count = substr_count($text, "/");

        if ($split_slash_count == 0) {

            $bet_type = "single";

            $bet_string = checkbetstring($text);
            $bet_value = checkbetvalue($text);

            if ($bet_string == "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•") {
                $messages = [
                    'type' => 'text',
                    'text' => "UserID : " . $userID . "\r\n" . "GroupID : " . $groupID
                ];
            } else if ($bet_string == "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠") {
                $ch = curl_init('http://e-sport.in.th/ssdev/dt/dashboard/api/user_test/profile/' . $userID);
                curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json',));
                $result = curl_exec($ch);
                curl_close($ch);
                $resultData = json_decode($result, true);
                $data = $resultData['data'];
                $line_id = $data['user_lineid'];
                $credit = $data['credit'];

                if ($line_id == $userID) {
                    $messages = [
                        'type' => 'text',
                        'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . "UserID : " . $userID . "\r\n" . "üí∞‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ : " . $credit . " ‡∏ö‡∏≤‡∏ó"
                    ];
                } else {
                    $messages = [
                        'type' => 'text',
                        'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . "ü•∫ ‡∏ó‡πà‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" . "\r\n" . "üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå : play",
                        "quickReply" => [
                            "items" => [
                                [
                                    "type" => "action",
                                    "action" => [
                                        "type" => "message",
                                        "label" => "üëâ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å",
                                        "text" => "play"
                                    ]
                                ]
                            ]
                        ]
                    ];
                }
            } else if ($bet_string == "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å") {
                $messages = [
                    'type' => 'text',
                    'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . " ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚ùå"
                ];
            } else if ($bet_string == "‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô") {
                $messages = [
                    'type' => 'text',
                    'text' => "\" ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô \"" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™ = ‡πÄ‡∏™‡∏∑‡∏≠" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏° = ‡∏°‡∏±‡∏á‡∏Å‡∏£" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏Ñ = ‡∏Ñ‡∏π‡πà" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™‡∏° = ‡πÄ‡∏™‡∏°‡∏≠" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™‡∏Ñ‡∏π‡πà = ‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™‡∏Ñ‡∏µ‡πà = ‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏°‡∏Ñ‡∏π‡πà = ‡∏°‡∏±‡∏á‡∏Å‡∏£‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏°‡∏Ñ‡∏µ‡πà = ‡∏°‡∏±‡∏á‡∏Å‡∏£‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™‡∏î‡∏≥ = ‡πÄ‡∏™‡∏∑‡∏≠‡∏î‡∏≥" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™‡πÅ‡∏î‡∏á = ‡πÄ‡∏™‡∏∑‡∏≠‡πÅ‡∏î‡∏á" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏°‡∏î‡∏≥ = ‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏î‡∏≥" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏°‡πÅ‡∏î‡∏á = ‡∏°‡∏±‡∏á‡∏Å‡∏£‡πÅ‡∏î‡∏á" . "\r\n" . "\r\n" . "\" ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô \"" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™1000" . "\r\n" . "‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö : ‡πÅ‡∏ó‡∏á‡πÄ‡∏™‡∏∑‡∏≠1000‡∏ö‡∏≤‡∏ó" . "\r\n" . "\r\n" . "\" ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö \"" . "\r\n" . "‡∏û‡∏¥‡∏°‡∏û‡πå : ‡∏™1000/‡∏°5000/‡∏™‡∏î‡∏≥1000" . "\r\n" . "‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö : ‡πÅ‡∏ó‡∏á‡πÄ‡∏™‡∏∑‡∏≠1000‡∏ö‡∏≤‡∏ó ‡πÅ‡∏ó‡∏á‡∏°‡∏±‡∏á‡∏Å‡∏£5000‡∏ö‡∏≤‡∏ó ‡πÅ‡∏ó‡∏á‡πÄ‡∏™‡∏∑‡∏≠‡∏î‡∏≥1000‡∏ö‡∏≤‡∏ó"
                ];
            } else if ($bet_string == "‡∏™‡∏°‡∏±‡∏Ñ‡∏£") {
                $ch = curl_init('http://e-sport.in.th/ssdev/dt/dashboard/api/user_test/profile/' . $userID);
                curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json',));
                $result = curl_exec($ch);
                curl_close($ch);
                $resultData = json_decode($result, true);
                $data = $resultData['data'];
                $line_id = $data['user_lineid'];
                if ($line_id == $userID) {
                    $messages = [
                        'type' => 'text',
                        'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . "üòá ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"
                    ];
                } else {
                    $data = array(
                        "user_displayname" => $user_displayname,
                        "fullname" => $user_displayname,
                        "user_lineid" => $userID,
                    );

                    $data_register = json_encode($data);

                    $ch = curl_init('http://e-sport.in.th/ssdev/dt/dashboard/api/user_test/register');

                    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
                    curl_setopt($ch, CURLOPT_POSTFIELDS, $data_register);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                    curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json'));

                    $result = curl_exec($ch);
                    curl_close($ch);

                    $messages = [
                        'type' => 'text',
                        'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . "‚úÖ ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ" . "\r\n"
                    ];
                }
            } else {
                if (!$bet_string) {
                    $messages = [
                        'type' => 'text',
                        'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . "‚õîÔ∏è ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
                        "quickReply" => [
                            "items" => [
                                [
                                    "type" => "action",
                                    "action" => [
                                        "type" => "message",
                                        "label" => "üëâ ‡∏î‡∏π‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô",
                                        "text" => "step"
                                    ]
                                ]
                            ]
                        ]
                    ];
                } else if (!is_numeric($bet_value)) {

                    $messages = [
                        'type' => 'text',
                        'text' => "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . "\r\n" . "‚õîÔ∏è ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
                        "quickReply" => [
                            "items" => [
                                [
                                    "type" => "action",
                                    "action" => [
                                        "type" => "message",
                                        "label" => "üëâ ‡∏î‡∏π‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô",
                                        "text" => "step"
                                    ]
                                ]
                            ]
                        ]
                    ];
                } else {
                    $ch = curl_init('http://e-sport.in.th/ssdev/dt/dashboard/api/user_test/profile/' . $userID);
                    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                    curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json',));
                    $result = curl_exec($ch);
                    curl_close($ch);
                    $resultData = json_decode($result, true);
                    $data = $resultData['data'];
                    $user_id = $data['id'];

                    $url = 'http://e-sport.in.th/ssdev/dt/dashboard/api/bet_test/logbet_create';
                    $fields = array(
                        'user_id' => "a",
                        'user_lineid' => "a",
                        'user_displayname' => "a",
                        'bet_text' => "a",
                        'value' => "50.00",
                        'bet_code' => "a"
                    );
                    foreach ($fields as $key => $value) {
                        $fields_string .= $key . '=' . $value . '&';
                    }
                    rtrim($fields_string, '&');

                    $ch = curl_init();
                    curl_setopt($ch, CURLOPT_URL, $url);
                    curl_setopt($ch, CURLOPT_POST, count($fields));
                    curl_setopt($ch, CURLOPT_POSTFIELDS, $fields_string);
                    $result = curl_exec($ch);
                    curl_close($ch);
                    //check the result
                    var_dump($result);

                    $messages = [
                        'type' => 'text',
                        'text' => $fields_string . $result
                    ];
                }
            }
        } else if ($split_slash_count > 0) {

            $reponse_bet = '';
            $bet_type = "multiple";
            $arrKeywords = explode("/", $text);
            $i = 0;
            foreach ($arrKeywords as $element) {

                $i++;
                $bet_string = checkbetstring($element);
                $bet_value = checkbetvalue($element);

                // echo $bet_string;
                if (!$bet_string) {

                    $element_reponse = '# ' . $i . ' ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (!is_numeric($bet_value)) {


                    $element_reponse = '# ' . $i . ' ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else {

                    $element_reponse = '# ' . $i . ' ‡πÅ‡∏ó‡∏á > ' . $bet_string . " ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô " . $bet_value;
                }


                $reponse_bet = $reponse_bet . "\n" . $element_reponse;
            }


            $messages = [
                'type' => 'text',
                'text' => " ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô : " . $user_displayname . " " . $reponse_bet . "\r\n" . "üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ : "
            ];
        }
    }






    $url = 'https://api.line.me/v2/bot/message/reply';
    $data = [
        'replyToken' => $replyToken,
        'messages' => [$messages],
    ];
    $post = json_encode($data);
    $headers = array('Content-Type: application/json', 'Authorization: Bearer ' . $access_token);

    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $post);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    $result = curl_exec($ch);
    curl_close($ch);

    // echo $result . "\r\n";


    // echo "OK";
}
